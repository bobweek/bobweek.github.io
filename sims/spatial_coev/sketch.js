function setup(){document.body.style.margin="0",document.body.style.padding="0",document.body.style.overflow="hidden",pixelDensity(1),canvas=createCanvas(400,700),canvas.elt.style.touchAction="manipulation",noStroke(),background(0),mig1=new HScrollbar(25,50,120,20,5,120),mig2=new HScrollbar(25,100,120,20,5,70),mig3=new HScrollbar(25,150,120,20,5,30),m12=new HScrollbar(25,200,120,20,5,120),m13=new HScrollbar(25,250,120,20,5,20),m23=new HScrollbar(25,300,120,20,5,120),grid=new Array(wid);for(let s=0;s<wid;s++){grid[s]=new Array(hi);for(let i=0;i<hi;i++)grid[s][i]=new Cell(random(0,255),random(0,255),random(0,255),s,i)}}function draw(){if(pause){if(pause1){for(let s=0;s<wid;s++)for(let i=0;i<hi;i++)grid[s][i].render();m[0]=.75*(mig1.spos-mig1.sposMin)/(mig1.sposMax-mig1.sposMin),m[1]=.75*(mig2.spos-mig2.sposMin)/(mig2.sposMax-mig2.sposMin),m[2]=.75*(mig3.spos-mig3.sposMin)/(mig3.sposMax-mig3.sposMin),Mratio=2,Msel12=.1*(m12.spos-m12.sposMin)/(m12.sposMax-m12.sposMin),Msel13=.1*(m13.spos-m13.sposMin)/(m13.sposMax-m13.sposMin),Msel23=.1*(m23.spos-m23.sposMin)/(m23.sposMax-m23.sposMin),M[1][0]=Msel12,M[2][1]=Msel13,M[0][2]=Msel23,M[0][1]=-Msel12,M[1][2]=-Mratio*Msel13,M[2][0]=-Mratio*Msel23,dummy=new Array(wid);for(let s=0;s<wid;s++){dummy[s]=new Array(hi);for(let i=0;i<hi;i++)dummy[s][i]=new Cell(grid[s][i].species[0],grid[s][i].species[1],grid[s][i].species[2],s,i)}for(let s=wid-1;s>=0;s--)for(let i=hi-1;i>=0;i--)grid[s][i].update(dummy);mig1.update(),mig1.display(),mig2.update(),mig2.display(),mig3.update(),mig3.display(),m12.update(),m12.display(),m13.update(),m13.display(),m23.update(),m23.display(),fill(0),rect(mig1.xpos-2,mig1.ypos-20,90,12),rect(mig2.xpos-2,mig2.ypos-20,90,12),rect(mig3.xpos-2,mig3.ypos-20,90,12),rect(m12.xpos-2,m12.ypos-20,125,12),rect(m13.xpos-2,m13.ypos-20,125,12),rect(m23.xpos-2,m23.ypos-20,125,12),fill(255),text("spp1 migration",mig1.xpos,mig1.ypos-10),text("spp2 migration",mig2.xpos,mig2.ypos-10),text("spp3 migration",mig3.xpos,mig3.ypos-10),text("spp 1 & 2 coevolution",m12.xpos,m12.ypos-10),text("spp 1 & 3 coevolution",m13.xpos,m13.ypos-10),text("spp 2 & 3 coevolution",m23.xpos,m23.ypos-10)}fill(0),rect(140,360,220,70),fill(255),text("press h to toggle controls",150,380),text("press +/- to incr/decr resolution",150,400),text("press r to reset with random values",150,420),pause1=!1,updateAndDrawUI()}else{for(let s=0;s<wid;s++)for(let i=0;i<hi;i++)grid[s][i].render();m[0]=.75*(mig1.spos-mig1.sposMin)/(mig1.sposMax-mig1.sposMin),m[1]=.75*(mig2.spos-mig2.sposMin)/(mig2.sposMax-mig2.sposMin),m[2]=.75*(mig3.spos-mig3.sposMin)/(mig3.sposMax-mig3.sposMin),Mratio=2,Msel12=.1*(m12.spos-m12.sposMin)/(m12.sposMax-m12.sposMin),Msel13=.1*(m13.spos-m13.sposMin)/(m13.sposMax-m13.sposMin),Msel23=.1*(m23.spos-m23.sposMin)/(m23.sposMax-m23.sposMin),M[1][0]=Msel12,M[2][1]=Msel13,M[0][2]=Msel23,M[0][1]=-Msel12,M[1][2]=-Mratio*Msel13,M[2][0]=-Mratio*Msel23,dummy=new Array(wid);for(let s=0;s<wid;s++){dummy[s]=new Array(hi);for(let i=0;i<hi;i++)dummy[s][i]=new Cell(grid[s][i].species[0],grid[s][i].species[1],grid[s][i].species[2],s,i)}for(let s=wid-1;s>=0;s--)for(let i=hi-1;i>=0;i--)grid[s][i].update(dummy);0===hud&&(mig1.update(),mig1.display(),mig2.update(),mig2.display(),mig3.update(),mig3.display(),m12.update(),m12.display(),m13.update(),m13.display(),m23.update(),m23.display(),fill(0),rect(mig1.xpos-2,mig1.ypos-20,90,12),rect(mig2.xpos-2,mig2.ypos-20,90,12),rect(mig3.xpos-2,mig3.ypos-20,90,12),rect(m12.xpos-2,m12.ypos-20,125,12),rect(m13.xpos-2,m13.ypos-20,125,12),rect(m23.xpos-2,m23.ypos-20,125,12),fill(255),text("spp1 migration",mig1.xpos,mig1.ypos-10),text("spp2 migration",mig2.xpos,mig2.ypos-10),text("spp3 migration",mig3.xpos,mig3.ypos-10),text("spp 1 & 2 coevolution",m12.xpos,m12.ypos-10),text("spp 1 & 3 coevolution",m13.xpos,m13.ypos-10),text("spp 2 & 3 coevolution",m23.xpos,m23.ypos-10)),updateAndDrawUI()}}function keyReleased(){switch(key){case"+":dummy=new Array(wid);for(let s=0;s<wid;s++){dummy[s]=new Array(hi);for(let i=0;i<hi;i++)dummy[s][i]=new Cell(grid[s][i].species[0],grid[s][i].species[1],grid[s][i].species[2],s,i)}old_wid=wid,old_hi=hi,hi+=3,wid+=4,grid=new Array(wid);for(let s=0;s<wid;s++){grid[s]=new Array(hi);for(let i=0;i<hi;i++)grid[s][i]=new Cell(dummy[s%(old_wid-1)][i%(old_hi-1)].species[0],dummy[s%(old_wid-1)][i%(old_hi-1)].species[1],dummy[s%(old_wid-1)][i%(old_hi-1)].species[2],s,i)}dummy=null;break;case"-":dummy=new Array(wid);for(let s=0;s<wid;s++){dummy[s]=new Array(hi);for(let i=0;i<hi;i++)dummy[s][i]=new Cell(grid[s][i].species[0],grid[s][i].species[1],grid[s][i].species[2],s,i)}old_wid=wid,old_hi=hi,hi-=3,hi<3&&(hi=3),wid-=4,wid<4&&(wid=4),grid=new Array(wid);for(let s=0;s<wid;s++){grid[s]=new Array(hi);for(let i=0;i<hi;i++)grid[s][i]=new Cell(dummy[s%(old_wid-1)][i%(old_hi-1)].species[0],dummy[s%(old_wid-1)][i%(old_hi-1)].species[1],dummy[s%(old_wid-1)][i%(old_hi-1)].species[2],s,i)}dummy=null;break;case"h":hud=(1+hud)%2;break;case"p":pause=!pause,pause1=!0;break;case"r":for(let s=0;s<wid;s++)for(let i=0;i<hi;i++)grid[s][i].set(random(0,255),random(0,255),random(0,255))}}function abiotic_selection(s,i){return.1*exp(-(i-height/2)*(i-height/2)/1e5)*exp(-(s-width/2)*(s-width/2)/1e5)}function biotic_selection(s,i){return.1*exp(-(i-height/2)*(i-height/2)/1e5)*exp(-(s-width/2)*(s-width/2)/1e5)}function theta(s,i,e){let o=0;return 0===e&&(o=55+200*exp(-(i-2*height/5)*(i-2*height/5)/2e4)*exp(-(s-3*width/8)*(s-3*width/8)/2e4)),1===e&&(o=55+200*exp(-(i-2*height/5)*(i-2*height/5)/2e4)*exp(-(s-5*width/8)*(s-5*width/8)/2e4)),2===e&&(o=55+200*exp(-(i-3*height/5)*(i-3*height/5)/2e4)*exp(-(s-width/2)*(s-width/2)/2e4)),o}function N(s,i){return 10+500*exp(-(i-height/2)*(i-height/2)/1e4)*exp(-(s-width/2)*(s-width/2)/1e4)}function initGridFromInstructions(){const s="press p to pause/play\npress +/- to incr/decr resolution\npress r to reset with random values",i=createGraphics(wid,hi);i.pixelDensity(1),i.background(0),i.fill(255),i.noStroke(),i.textAlign(CENTER,CENTER),i.textSize(max(8,floor(.12*min(wid,hi)))),i.text(s,wid/2,hi/2),i.loadPixels();for(let s=0;s<wid;s++)for(let e=0;e<hi;e++){const o=4*(s+wid*e),t=i.pixels[o+0],p=i.pixels[o+1],m=i.pixels[o+2];grid[s][e].set(t,p,m)}}function mousePressed(){return mig1.overEvent()||mig2.overEvent()||mig3.overEvent()||m12.overEvent()||m13.overEvent()||m23.overEvent()||(pause=!pause,pause1=!0),!1}function updateAndDrawUI(){0===hud&&(mig1.update(),mig1.display(),mig2.update(),mig2.display(),mig3.update(),mig3.display(),m12.update(),m12.display(),m13.update(),m13.display(),m23.update(),m23.display(),fill(0),rect(mig1.xpos-2,mig1.ypos-20,82,12),rect(mig2.xpos-2,mig2.ypos-20,82,12),rect(mig3.xpos-2,mig3.ypos-20,82,12),rect(m12.xpos-2,m12.ypos-20,118,12),rect(m13.xpos-2,m13.ypos-20,118,12),rect(m23.xpos-2,m23.ypos-20,118,12),fill(255),text("spp1 migration",mig1.xpos,mig1.ypos-10),text("spp2 migration",mig2.xpos,mig2.ypos-10),text("spp3 migration",mig3.xpos,mig3.ypos-10),text("spp 1 & 2 coevolution",m12.xpos,m12.ypos-10),text("spp 1 & 3 coevolution",m13.xpos,m13.ypos-10),text("spp 2 & 3 coevolution",m23.xpos,m23.ypos-10))}let grid,dummy,w,h,old_wid,old_hi,picCount,Msel12,Msel13,Msel23,log_e,filename,number,c,mig1,mig2,mig3,m12,m13,m23,wid=80,hi=140,neighborhood=0,hud=1,k=0,e=1,count=0,C=.01,mix=0,loge=.01,Mratio=2,m=[.1,.1,.1],drift=[0,0,0],G=[1,1,1],Gamma=[0,0,0],M=[[0,0,0],[0,0,0],[0,0,0]],m_SL="",mig="",M_SL="",Mratio_SL="",A_SL="",Image="",Ran="",Size="",contrast="",Mix="",pic=!1,rando=!1,vid=!1,rev=!1,capture=!1,pause=!1,pause1=!1;class HScrollbar{constructor(s,i,e,o,t,p){this.swidth=e,this.sheight=o;const m=e-o;this.ratio=e/m,this.xpos=s,this.ypos=i-o/2,this.spos=p,this.newspos=this.spos,this.sposMin=this.xpos,this.sposMax=this.xpos+this.swidth-this.sheight,this.loose=t,this.over=!1,this.locked=!1}update(){this.over=this.overEvent(),mouseIsPressed&&this.over&&(this.locked=!0),mouseIsPressed||(this.locked=!1),this.locked&&(this.newspos=constrain(mouseX-this.sheight/2,this.sposMin,this.sposMax)),abs(this.newspos-this.spos)>1&&(this.spos=this.spos+(this.newspos-this.spos)/this.loose)}overEvent(){return mouseX>this.xpos&&mouseX<this.xpos+this.swidth&&mouseY>this.ypos&&mouseY<this.ypos+this.sheight}display(){fill(204),rect(this.xpos,this.ypos,this.swidth,this.sheight),this.over||this.locked?fill(0):fill(102),rect(this.spos,this.ypos,this.sheight,this.sheight)}getPos(){return this.spos*this.ratio}}